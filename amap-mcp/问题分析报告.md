# é«˜å¾·API MCPæœåŠ¡å™¨ä»£ç æ£€æŸ¥æŠ¥å‘Š

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. ç¯å¢ƒå˜é‡è¯»å–é”™è¯¯ï¼ˆç¬¬38è¡Œï¼‰
**é—®é¢˜**ï¼šä»£ç ä¸­ç¡¬ç¼–ç äº†å­—ç¬¦ä¸² `"AMAP_API_KEY"` è€Œä¸æ˜¯ä»ç¯å¢ƒå˜é‡è¯»å–
```python
# é”™è¯¯ï¼š
AMAP_API_KEY = "AMAP_API_KEY"

# å·²ä¿®å¤ä¸ºï¼š
AMAP_API_KEY = os.getenv("AMAP_API_KEY")
```

### 2. é™æ€åœ°å›¾æ–¹æ³•ä¸­çš„self.clientè®¿é—®é—®é¢˜ï¼ˆç¬¬773è¡Œï¼‰
**é—®é¢˜**ï¼šåœ¨ `format_response` æ–¹æ³•ä¸­è®¿é—® `self.client.api_key`ï¼Œä½† `self.client` å¯èƒ½ä¸º None
```python
# é”™è¯¯ï¼š
image_url = f"...&key={self.client.api_key}"

# å·²ä¿®å¤ä¸ºï¼š
api_key = AMAP_API_KEY or ""
image_url = f"...&key={api_key}"
```

## âš ï¸ éœ€è¦ä¿®å¤çš„é—®é¢˜

### 3. MCPæœåŠ¡å™¨å®ç°æ–¹å¼ä¸æ­£ç¡®ï¼ˆç¬¬17-18è¡Œï¼Œç¬¬920-945è¡Œï¼‰

**é—®é¢˜**ï¼šä»£ç ä½¿ç”¨äº† `ClientSession`ï¼Œè¿™æ˜¯å®¢æˆ·ç«¯APIï¼Œä¸æ˜¯æœåŠ¡å™¨APIã€‚æ­£ç¡®çš„MCPæœåŠ¡å™¨åº”è¯¥ä½¿ç”¨ `Server` ç±»ã€‚

**å½“å‰å®ç°**ï¼š
```python
from mcp import ClientSession, StdioServerParameters
from mcp.client import stdio

async with stdio.stdio_server(server_params) as (read_stream, write_stream):
    async with ClientSession(read_stream, write_stream) as session:
        # ...
```

**æ­£ç¡®çš„å®ç°æ–¹å¼**ï¼ˆæ¨èä½¿ç”¨FastMCPï¼‰ï¼š
```python
from mcp.server.fastmcp import FastMCP

mcp = FastMCP("amap-mcp-server")

@mcp.tool()
async def geocode(address: str, city: str = None):
    # å®ç°åœ°ç†ç¼–ç 
    pass

if __name__ == "__main__":
    mcp.run(transport="stdio")
```

**æˆ–è€…ä½¿ç”¨åŸå§‹MCP Server API**ï¼š
```python
from mcp.server import Server
from mcp.server.stdio import stdio_server

app = Server("amap-mcp-server")

@app.tool()
async def geocode(address: str, city: str = None):
    # å®ç°åœ°ç†ç¼–ç 
    pass

async def main():
    async with stdio_server() as (read_stream, write_stream):
        await app.run(read_stream, write_stream, app.create_initialization_options())

if __name__ == "__main__":
    asyncio.run(main())
```

### 4. æœªä½¿ç”¨çš„å¯¼å…¥å’Œç±»

ä»¥ä¸‹å¯¼å…¥å’Œç±»å®šä¹‰æœªè¢«ä½¿ç”¨ï¼Œå¯ä»¥åˆ é™¤ï¼š
- `Enum` (ç¬¬12è¡Œ)
- `dataclass` (ç¬¬13è¡Œ)
- `datetime` (ç¬¬14è¡Œ)
- `ImageContent` (ç¬¬22è¡Œ)
- `EmbeddedResource` (ç¬¬23è¡Œ)
- `quote` (ç¬¬28è¡Œ)
- `Coordinate` (ç¬¬46-49è¡Œ)
- `GeoCodeRequest` (ç¬¬52-55è¡Œ)
- `RegeoCodeRequest` (ç¬¬58-61è¡Œ)
- `DrivingRouteRequest` (ç¬¬64-69è¡Œ)
- `WalkingRouteRequest` (ç¬¬72-75è¡Œ)
- `TransitRouteRequest` (ç¬¬78-83è¡Œ)
- `IPLocationRequest` (ç¬¬86-89è¡Œ)
- `WeatherRequest` (ç¬¬92-95è¡Œ)
- `DistrictSearchRequest` (ç¬¬98-103è¡Œ)
- `AroundPlaceRequest` (ç¬¬106-113è¡Œ)
- `GeoFenceRequest` (ç¬¬116-119è¡Œ)
- `StaticMapRequest` (ç¬¬122-129è¡Œ)

### 5. StdioServerParameters ä½¿ç”¨ä¸æ­£ç¡®ï¼ˆç¬¬912-916è¡Œï¼‰

**é—®é¢˜**ï¼š`StdioServerParameters` çš„å‚æ•°è®¾ç½®ä¸æ­£ç¡®ã€‚å¯¹äºstdioæœåŠ¡å™¨ï¼Œé€šå¸¸ä¸éœ€è¦è¿™äº›å‚æ•°ã€‚

**å½“å‰ä»£ç **ï¼š
```python
server_params = StdioServerParameters(
    command="python",
    args=["-c", "print('MCP Server Started')"],
    env=None
)
```

è¿™ä¸ªå‚æ•°é…ç½®çœ‹èµ·æ¥æ˜¯ç”¨äºå¯åŠ¨å­è¿›ç¨‹çš„ï¼Œä½†å¯¹äºstdioæœåŠ¡å™¨ï¼Œåº”è¯¥ç›´æ¥ä½¿ç”¨æ ‡å‡†è¾“å…¥è¾“å‡ºã€‚

## ğŸ“ å»ºè®®

1. **é‡æ„ä¸ºFastMCP**ï¼šæ¨èä½¿ç”¨FastMCPæ¡†æ¶ï¼Œå®ƒæ›´ç®€å•æ˜“ç”¨ï¼Œä»£ç æ›´æ¸…æ™°
2. **æ¸…ç†æœªä½¿ç”¨çš„ä»£ç **ï¼šåˆ é™¤æœªä½¿ç”¨çš„å¯¼å…¥å’Œç±»å®šä¹‰
3. **æµ‹è¯•MCPæœåŠ¡å™¨**ï¼šç¡®ä¿æœåŠ¡å™¨èƒ½å¤Ÿæ­£ç¡®å“åº”MCPå®¢æˆ·ç«¯çš„è¯·æ±‚
4. **æ·»åŠ é”™è¯¯å¤„ç†**ï¼šåœ¨å…³é”®ä½ç½®æ·»åŠ æ›´å®Œå–„çš„é”™è¯¯å¤„ç†

## ğŸ”§ ä¿®å¤ä¼˜å…ˆçº§

1. **é«˜ä¼˜å…ˆçº§**ï¼šä¿®å¤MCPæœåŠ¡å™¨å®ç°æ–¹å¼ï¼ˆé—®é¢˜3ï¼‰- è¿™æ˜¯æ ¸å¿ƒåŠŸèƒ½
2. **ä¸­ä¼˜å…ˆçº§**ï¼šæ¸…ç†æœªä½¿ç”¨çš„ä»£ç ï¼ˆé—®é¢˜4ï¼‰
3. **ä½ä¼˜å…ˆçº§**ï¼šä¼˜åŒ–ä»£ç ç»“æ„å’Œé”™è¯¯å¤„ç†

